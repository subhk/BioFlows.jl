<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Codebase Structure · BioFlows.jl</title><meta name="title" content="Codebase Structure · BioFlows.jl"/><meta property="og:title" content="Codebase Structure · BioFlows.jl"/><meta property="twitter:title" content="Codebase Structure · BioFlows.jl"/><meta name="description" content="Documentation for BioFlows.jl."/><meta property="og:description" content="Documentation for BioFlows.jl."/><meta property="twitter:description" content="Documentation for BioFlows.jl."/><meta property="og:url" content="https://subhk.github.io/BioFlows.jl/codebase_structure/"/><meta property="twitter:url" content="https://subhk.github.io/BioFlows.jl/codebase_structure/"/><link rel="canonical" href="https://subhk.github.io/BioFlows.jl/codebase_structure/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BioFlows.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../gpu/">GPU Acceleration</a></li><li><a class="tocitem" href="../core_types/">Core Types</a></li><li><a class="tocitem" href="../amr/">Adaptive Mesh Refinement</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../numerical_methods/">Numerical Methods</a></li><li class="is-active"><a class="tocitem" href>Codebase Structure</a><ul class="internal"><li><a class="tocitem" href="#Directory-Layout"><span>Directory Layout</span></a></li><li><a class="tocitem" href="#Core-Modules"><span>Core Modules</span></a></li><li><a class="tocitem" href="#Adaptive-Mesh-Refinement-(AMR)"><span>Adaptive Mesh Refinement (AMR)</span></a></li><li><a class="tocitem" href="#Fluid-Structure-Interaction-(FSI)"><span>Fluid-Structure Interaction (FSI)</span></a></li><li><a class="tocitem" href="#Diagnostics-(Diagnostics.jl)"><span>Diagnostics (<code>Diagnostics.jl</code>)</span></a></li><li><a class="tocitem" href="#Memory-and-Backends"><span>Memory and Backends</span></a></li><li><a class="tocitem" href="#Module-Dependency-Graph"><span>Module Dependency Graph</span></a></li><li><a class="tocitem" href="#Key-Conventions"><span>Key Conventions</span></a></li><li><a class="tocitem" href="#Extending-BioFlows"><span>Extending BioFlows</span></a></li><li><a class="tocitem" href="#Performance-Tips"><span>Performance Tips</span></a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Codebase Structure</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Codebase Structure</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/BioFlows.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/subhk/BioFlows.jl/blob/main/docs/src/codebase_structure.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Codebase-Structure"><a class="docs-heading-anchor" href="#Codebase-Structure">Codebase Structure</a><a id="Codebase-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Codebase-Structure" title="Permalink"></a></h1><p>This document provides an overview of the BioFlows.jl source code organization, module dependencies, and key components.</p><h2 id="Directory-Layout"><a class="docs-heading-anchor" href="#Directory-Layout">Directory Layout</a><a id="Directory-Layout-1"></a><a class="docs-heading-anchor-permalink" href="#Directory-Layout" title="Permalink"></a></h2><pre><code class="nohighlight hljs">BioFlows.jl/
├── src/                          # Source code
│   ├── BioFlows.jl               # Main module file
│   ├── Flow.jl                   # Flow solver, BDIM, time stepping
│   ├── Poisson.jl                # Base Poisson pressure solver
│   ├── MultiLevelPoisson.jl      # Multigrid pressure solver
│   ├── Body.jl                   # Abstract body types and SDF utilities
│   ├── AutoBody.jl               # Implicit geometry via SDFs
│   ├── util.jl                   # Utilities, macros, boundary conditions
│   ├── Diagnostics.jl            # Force computation, vorticity
│   ├── Metrics.jl                # Flow statistics (mean flow, Reynolds stress)
│   ├── Output.jl                 # I/O utilities (JLD2 writers)
│   ├── amr/                      # Adaptive Mesh Refinement
│   │   ├── amr_types.jl          # Core AMR data structures
│   │   ├── amr_project.jl        # AMR projection and momentum step
│   │   ├── amr_adapter.jl           # Flow-to-grid adapters
│   │   ├── body_refinement_indicator.jl  # Refinement criteria
│   │   ├── composite_poisson.jl  # Multi-level pressure solver
│   │   ├── composite_solver.jl   # Composite grid solver
│   │   ├── interface_operators.jl # Coarse-fine interface operators
│   │   ├── patch_creation.jl     # AMR patch management
│   │   ├── patch_poisson.jl      # Patch-level pressure solver
│   │   └── refined_fields.jl     # Refined velocity field storage
│   └── fsi/                      # Fluid-Structure Interaction
│       ├── EulerBernoulliBeam.jl # Beam dynamics solver
│       ├── FluidStructureCoupling.jl  # Beam-fluid coupling (FSISimulation)
│       └── BeamAMR.jl            # BeamAMRSimulation for flexible bodies with AMR
├── examples/                     # Example scripts
│   ├── circle_benchmark.jl       # Simple cylinder benchmark
│   ├── flow_past_cylinder_2d.jl  # Comprehensive 2D cylinder example
│   ├── oscillating_cylinder.jl   # Moving cylinder with sinusoidal motion
│   ├── sphere_3d.jl              # 3D sphere wake simulation
│   ├── torus_3d.jl               # 3D torus in periodic flow
│   ├── swimming_fish.jl          # Flexible swimming fish (FSI)
│   └── swimming_fish_amr.jl      # Swimming fish with adaptive mesh refinement
├── test/                         # Test suite
│   ├── runtests.jl               # Main test runner
│   ├── test_amr.jl               # AMR functionality tests
│   ├── test_composite_poisson.jl # Composite Poisson solver tests
│   ├── test_fvm.jl               # Finite volume method tests
│   └── test_pressure_solver.jl   # Pressure solver tests
└── docs/                         # Documentation (Documenter.jl)</code></pre><h2 id="Core-Modules"><a class="docs-heading-anchor" href="#Core-Modules">Core Modules</a><a id="Core-Modules-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Modules" title="Permalink"></a></h2><h3 id="Main-Module-(BioFlows.jl)"><a class="docs-heading-anchor" href="#Main-Module-(BioFlows.jl)">Main Module (<code>BioFlows.jl</code>)</a><a id="Main-Module-(BioFlows.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Main-Module-(BioFlows.jl)" title="Permalink"></a></h3><p>The entry point that:</p><ul><li>Imports all dependencies (KernelAbstractions, MPI, ForwardDiff, JLD2, etc.)</li><li>Includes all source files in dependency order</li><li>Defines core simulation types: <code>Simulation</code>, <code>AMRSimulation</code>, <code>FSISimulation</code>, <code>BeamAMRSimulation</code></li><li>Exports public API for flow solving, AMR, and FSI</li></ul><h3 id="Flow-Solver-(Flow.jl)"><a class="docs-heading-anchor" href="#Flow-Solver-(Flow.jl)">Flow Solver (<code>Flow.jl</code>)</a><a id="Flow-Solver-(Flow.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Flow-Solver-(Flow.jl)" title="Permalink"></a></h3><p>The heart of the CFD solver implementing:</p><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>Flow()</code></td><td style="text-align: right">Constructor for flow state (velocity, pressure, coefficients)</td></tr><tr><td style="text-align: right"><code>mom_step!()</code></td><td style="text-align: right">Full momentum step: predictor + pressure projection + corrector</td></tr><tr><td style="text-align: right"><code>BDIM!()</code></td><td style="text-align: right">Boundary Data Immersion Method for immersed boundaries</td></tr><tr><td style="text-align: right"><code>conv_diff!()</code></td><td style="text-align: right">Convection-diffusion operator (advection + viscous terms)</td></tr><tr><td style="text-align: right"><code>accelerate!()</code></td><td style="text-align: right">Apply body forces (gravity, prescribed accelerations)</td></tr><tr><td style="text-align: right"><code>exitBC!()</code></td><td style="text-align: right">Convective outlet boundary condition</td></tr><tr><td style="text-align: right"><code>project!()</code></td><td style="text-align: right">Pressure projection for divergence-free velocity</td></tr><tr><td style="text-align: right"><code>scale_u!()</code></td><td style="text-align: right">Velocity scaling for time stepping</td></tr></table><p><strong>Key data structures in <code>Flow</code>:</strong></p><pre><code class="language-julia hljs">struct Flow{T,D}
    u::Array{T,D+1}     # Velocity field (staggered)
    u⁰::Array{T,D+1}    # Previous velocity
    p::Array{T,D}       # Pressure
    f::Array{T,D+1}     # RHS / forcing
    σ::Array{T,D}       # Divergence
    μ₀::Array{T,D+1}    # BDIM volume fraction
    μ₁::Array{T,D+2}    # BDIM first moment (gradient correction)
    V::Array{T,D+1}     # Body velocity
    Δx::NTuple{D,T}     # Grid spacing
    Δt::Vector{T}       # Time step history
    # ... additional fields
end</code></pre><h3 id="Pressure-Solvers"><a class="docs-heading-anchor" href="#Pressure-Solvers">Pressure Solvers</a><a id="Pressure-Solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Solvers" title="Permalink"></a></h3><h4 id="Poisson.jl-Base-Solver"><a class="docs-heading-anchor" href="#Poisson.jl-Base-Solver"><code>Poisson.jl</code> - Base Solver</a><a id="Poisson.jl-Base-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Poisson.jl-Base-Solver" title="Permalink"></a></h4><ul><li>Conjugate gradient (CG) solver with geometric multigrid preconditioner</li><li>Handles periodic and Neumann boundary conditions</li><li>Key functions: <code>solver!()</code>, <code>mult!()</code>, <code>residual!()</code></li></ul><h4 id="MultiLevelPoisson.jl-Multigrid-Solver"><a class="docs-heading-anchor" href="#MultiLevelPoisson.jl-Multigrid-Solver"><code>MultiLevelPoisson.jl</code> - Multigrid Solver</a><a id="MultiLevelPoisson.jl-Multigrid-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#MultiLevelPoisson.jl-Multigrid-Solver" title="Permalink"></a></h4><ul><li>V-cycle multigrid preconditioner</li><li>Automatic coarsening up to 4x4 base grid</li><li>Restriction and prolongation operators</li></ul><h3 id="Boundary-Conditions-(util.jl)"><a class="docs-heading-anchor" href="#Boundary-Conditions-(util.jl)">Boundary Conditions (<code>util.jl</code>)</a><a id="Boundary-Conditions-(util.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions-(util.jl)" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>BC!()</code></td><td style="text-align: right">Apply velocity boundary conditions</td></tr><tr><td style="text-align: right"><code>exitBC!()</code></td><td style="text-align: right">Convective outlet BC (1D upwind advection)</td></tr><tr><td style="text-align: right"><code>perBC!()</code></td><td style="text-align: right">Periodic boundary conditions for scalars</td></tr></table><p><strong>BC Types:</strong></p><ul><li><strong>Dirichlet</strong>: Normal velocity component at domain boundaries</li><li><strong>Neumann</strong>: Zero-gradient for tangential components (stress-free)</li><li><strong>Periodic</strong>: Ghost cell copying for cyclic boundaries</li><li><strong>BDIM</strong>: No-slip on immersed bodies via μ₀/μ₁ weighting</li></ul><h3 id="Body-Definitions"><a class="docs-heading-anchor" href="#Body-Definitions">Body Definitions</a><a id="Body-Definitions-1"></a><a class="docs-heading-anchor-permalink" href="#Body-Definitions" title="Permalink"></a></h3><h4 id="Body.jl"><a class="docs-heading-anchor" href="#Body.jl"><code>Body.jl</code></a><a id="Body.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Body.jl" title="Permalink"></a></h4><ul><li><code>AbstractBody</code> type hierarchy</li><li><code>NoBody()</code> for flows without immersed objects</li><li><code>measure_sdf!()</code> for computing signed distance fields</li></ul><h4 id="AutoBody.jl"><a class="docs-heading-anchor" href="#AutoBody.jl"><code>AutoBody.jl</code></a><a id="AutoBody.jl-1"></a><a class="docs-heading-anchor-permalink" href="#AutoBody.jl" title="Permalink"></a></h4><ul><li>Implicit geometry via signed distance functions (SDFs)</li><li>Supports CSG operations: union (<code>+</code>), subtraction (<code>-</code>)</li><li>Time-dependent geometry via <code>map(x, t)</code> transformations</li></ul><pre><code class="language-julia hljs"># Example: Cylinder at (cx, cz) with radius R
sdf(x, t) = sqrt((x[1] - cx)^2 + (x[2] - cz)^2) - R
body = AutoBody(sdf)

# Moving cylinder with velocity (Vx, Vz)
map(x, t) = x .- (Vx*t, Vz*t)
body = AutoBody(sdf, map)</code></pre><h2 id="Adaptive-Mesh-Refinement-(AMR)"><a class="docs-heading-anchor" href="#Adaptive-Mesh-Refinement-(AMR)">Adaptive Mesh Refinement (AMR)</a><a id="Adaptive-Mesh-Refinement-(AMR)-1"></a><a class="docs-heading-anchor-permalink" href="#Adaptive-Mesh-Refinement-(AMR)" title="Permalink"></a></h2><h3 id="Architecture"><a class="docs-heading-anchor" href="#Architecture">Architecture</a><a id="Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Architecture" title="Permalink"></a></h3><pre><code class="nohighlight hljs">AMRSimulation
    ├── Simulation (base grid)
    ├── AMRConfig (refinement parameters)
    ├── RefinedGrid (cell tracking)
    ├── CompositePoisson (multi-level pressure solver)
    │   ├── base_pois (MultiLevelPoisson)
    │   └── patches (Dict of PatchPoisson)
    └── FlowToGridAdapter</code></pre><h3 id="AMR-Files"><a class="docs-heading-anchor" href="#AMR-Files">AMR Files</a><a id="AMR-Files-1"></a><a class="docs-heading-anchor-permalink" href="#AMR-Files" title="Permalink"></a></h3><table><tr><th style="text-align: right">File</th><th style="text-align: right">Purpose</th></tr><tr><td style="text-align: right"><code>amr_types.jl</code></td><td style="text-align: right"><code>StaggeredGrid</code>, <code>RefinedGrid</code>, <code>SolutionState</code> types</td></tr><tr><td style="text-align: right"><code>amr_project.jl</code></td><td style="text-align: right"><code>amr_project!()</code>, <code>amr_mom_step!()</code></td></tr><tr><td style="text-align: right"><code>body_refinement_indicator.jl</code></td><td style="text-align: right">Refinement criteria based on body distance, gradients, vorticity</td></tr><tr><td style="text-align: right"><code>composite_poisson.jl</code></td><td style="text-align: right"><code>CompositePoisson</code> multi-level solver</td></tr><tr><td style="text-align: right"><code>composite_solver.jl</code></td><td style="text-align: right">Composite grid iteration</td></tr><tr><td style="text-align: right"><code>interface_operators.jl</code></td><td style="text-align: right">Coarse-fine interpolation, restriction</td></tr><tr><td style="text-align: right"><code>patch_creation.jl</code></td><td style="text-align: right">Create/manage <code>PatchPoisson</code> instances</td></tr><tr><td style="text-align: right"><code>patch_poisson.jl</code></td><td style="text-align: right">Individual patch pressure solver</td></tr><tr><td style="text-align: right"><code>refined_fields.jl</code></td><td style="text-align: right"><code>RefinedVelocityField</code> for storing fine-level data</td></tr></table><h3 id="Key-AMR-Functions"><a class="docs-heading-anchor" href="#Key-AMR-Functions">Key AMR Functions</a><a id="Key-AMR-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Key-AMR-Functions" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Create AMR-enabled simulation
sim = AMRSimulation((nx, nz), (Lx, Lz);
    body=body,
    amr_config=AMRConfig(max_level=2))

# Time stepping with automatic regridding
sim_step!(sim; remeasure=true)

# Force immediate regrid
force_regrid!(sim)

# Check divergence at all levels
check_divergence(sim; verbose=true)</code></pre><h2 id="Fluid-Structure-Interaction-(FSI)"><a class="docs-heading-anchor" href="#Fluid-Structure-Interaction-(FSI)">Fluid-Structure Interaction (FSI)</a><a id="Fluid-Structure-Interaction-(FSI)-1"></a><a class="docs-heading-anchor-permalink" href="#Fluid-Structure-Interaction-(FSI)" title="Permalink"></a></h2><h3 id="FSI-Files"><a class="docs-heading-anchor" href="#FSI-Files">FSI Files</a><a id="FSI-Files-1"></a><a class="docs-heading-anchor-permalink" href="#FSI-Files" title="Permalink"></a></h3><table><tr><th style="text-align: right">File</th><th style="text-align: right">Purpose</th></tr><tr><td style="text-align: right"><code>EulerBernoulliBeam.jl</code></td><td style="text-align: right">Beam dynamics with Hermite finite elements, <code>BeamMaterial</code>, <code>BeamGeometry</code></td></tr><tr><td style="text-align: right"><code>FluidStructureCoupling.jl</code></td><td style="text-align: right"><code>FlexibleBodyFSI</code>, <code>FSISimulation</code>, fluid-beam coupling</td></tr><tr><td style="text-align: right"><code>BeamAMR.jl</code></td><td style="text-align: right"><code>BeamAMRSimulation</code>, <code>FlexibleBodySDF</code>, AMR for flexible swimming bodies</td></tr></table><h3 id="Beam-Model"><a class="docs-heading-anchor" href="#Beam-Model">Beam Model</a><a id="Beam-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Beam-Model" title="Permalink"></a></h3><ul><li>Euler-Bernoulli beam theory (small deflections)</li><li>Hermite cubic shape functions (C1 continuity)</li><li>Newmark-beta time integration</li><li>Boundary conditions: <code>CLAMPED</code>, <code>FREE</code>, <code>PINNED</code>, <code>PRESCRIBED</code></li></ul><pre><code class="language-julia hljs"># Create beam material and geometry
material = BeamMaterial(ρ=1050.0, E=5e5)
geometry = BeamGeometry(0.2, 51; thickness=0.01, width=0.05)

# Create a flexible beam
beam = EulerBernoulliBeam(geometry, material;
    bc_left = CLAMPED,
    bc_right = FREE,
    damping = 0.1)

# Apply traveling wave muscle activation
f_wave = traveling_wave_forcing(
    amplitude=100.0,
    frequency=2.0,
    wavelength=1.0,
    envelope=:carangiform,
    L=0.2
)</code></pre><h3 id="BeamAMRSimulation"><a class="docs-heading-anchor" href="#BeamAMRSimulation">BeamAMRSimulation</a><a id="BeamAMRSimulation-1"></a><a class="docs-heading-anchor-permalink" href="#BeamAMRSimulation" title="Permalink"></a></h3><p>For flexible swimming bodies with adaptive mesh refinement:</p><pre><code class="language-julia hljs"># Create swimming fish simulation with AMR
sim = BeamAMRSimulation((256, 128), (2.0, 1.0);
    L_fish = 0.2,
    h_max = 0.02,
    E = 5e5,
    ρ_fish = 1050.0,
    amr_config = FlexibleBodyAMRConfig(max_level=2),
    ν = 1e-3)

# Time stepping with automatic regridding
for _ in 1:1000
    sim_step!(sim; remeasure=true)
end

# Check AMR status
beam_info(sim)</code></pre><h2 id="Diagnostics-(Diagnostics.jl)"><a class="docs-heading-anchor" href="#Diagnostics-(Diagnostics.jl)">Diagnostics (<code>Diagnostics.jl</code>)</a><a id="Diagnostics-(Diagnostics.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics-(Diagnostics.jl)" title="Permalink"></a></h2><h3 id="Force-Computation"><a class="docs-heading-anchor" href="#Force-Computation">Force Computation</a><a id="Force-Computation-1"></a><a class="docs-heading-anchor-permalink" href="#Force-Computation" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>pressure_force(sim)</code></td><td style="text-align: right">Pressure contribution to force</td></tr><tr><td style="text-align: right"><code>viscous_force(sim)</code></td><td style="text-align: right">Viscous contribution to force</td></tr><tr><td style="text-align: right"><code>total_force(sim)</code></td><td style="text-align: right">Sum of pressure and viscous forces</td></tr><tr><td style="text-align: right"><code>force_coefficients(sim)</code></td><td style="text-align: right">Cd, Cl (drag and lift coefficients)</td></tr></table><h3 id="Flow-Quantities"><a class="docs-heading-anchor" href="#Flow-Quantities">Flow Quantities</a><a id="Flow-Quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Flow-Quantities" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>ω(flow)</code></td><td style="text-align: right">Vorticity field (2D: scalar, 3D: vector)</td></tr><tr><td style="text-align: right"><code>ω_mag(flow)</code></td><td style="text-align: right">Vorticity magnitude</td></tr><tr><td style="text-align: right"><code>cell_center_velocity(flow)</code></td><td style="text-align: right">Interpolate staggered velocity to cell centers</td></tr><tr><td style="text-align: right"><code>cell_center_pressure(flow)</code></td><td style="text-align: right">Cell-centered pressure</td></tr></table><h2 id="Memory-and-Backends"><a class="docs-heading-anchor" href="#Memory-and-Backends">Memory and Backends</a><a id="Memory-and-Backends-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-and-Backends" title="Permalink"></a></h2><p>BioFlows.jl supports multiple compute backends via KernelAbstractions.jl:</p><pre><code class="language-julia hljs"># CPU (default)
sim = Simulation(dims, L; mem=Array, ...)

# GPU (requires CUDA.jl)
using CUDA
sim = Simulation(dims, L; mem=CuArray, ...)</code></pre><h3 id="Backend-Selection"><a class="docs-heading-anchor" href="#Backend-Selection">Backend Selection</a><a id="Backend-Selection-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Selection" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Check current backend
BioFlows.backend

# Set backend
BioFlows.set_backend(&quot;KernelAbstractions&quot;)  # Default, multi-threaded
BioFlows.set_backend(&quot;SIMD&quot;)                # Single-threaded, optimized</code></pre><h2 id="Module-Dependency-Graph"><a class="docs-heading-anchor" href="#Module-Dependency-Graph">Module Dependency Graph</a><a id="Module-Dependency-Graph-1"></a><a class="docs-heading-anchor-permalink" href="#Module-Dependency-Graph" title="Permalink"></a></h2><pre><code class="nohighlight hljs">BioFlows.jl
    │
    ├── util.jl (macros, BC functions)
    │
    ├── Poisson.jl
    │   └── MultiLevelPoisson.jl
    │
    ├── Body.jl
    │   └── AutoBody.jl
    │
    ├── Flow.jl (depends on Poisson, Body, util)
    │
    ├── amr/ (depends on Flow, Poisson)
    │   ├── amr_types.jl
    │   ├── amr_adapter.jl
    │   ├── body_refinement_indicator.jl
    │   ├── refined_fields.jl
    │   ├── patch_poisson.jl
    │   ├── interface_operators.jl
    │   ├── composite_poisson.jl
    │   ├── composite_solver.jl
    │   ├── patch_creation.jl
    │   └── amr_project.jl
    │
    ├── fsi/ (depends on Flow, amr/)
    │   ├── EulerBernoulliBeam.jl
    │   ├── FluidStructureCoupling.jl
    │   └── BeamAMR.jl
    │
    ├── Metrics.jl (depends on Flow)
    ├── Diagnostics.jl (depends on Flow, Body)
    └── Output.jl (depends on Flow, Diagnostics)</code></pre><h2 id="Key-Conventions"><a class="docs-heading-anchor" href="#Key-Conventions">Key Conventions</a><a id="Key-Conventions-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Conventions" title="Permalink"></a></h2><h3 id="Indexing"><a class="docs-heading-anchor" href="#Indexing">Indexing</a><a id="Indexing-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing" title="Permalink"></a></h3><ul><li><strong>Staggered grid</strong>: Velocity stored at face centers</li><li><strong>Ghost cells</strong>: 1-cell layer at domain boundaries</li><li><strong>Interior indices</strong>: <code>2:N+1</code> for N interior cells</li><li><strong><code>@inside</code> macro</strong>: Generates loops over interior cells</li></ul><h3 id="Coordinate-System"><a class="docs-heading-anchor" href="#Coordinate-System">Coordinate System</a><a id="Coordinate-System-1"></a><a class="docs-heading-anchor-permalink" href="#Coordinate-System" title="Permalink"></a></h3><ul><li><strong>2D</strong>: <code>(x, z)</code> where <code>x</code> is streamwise, <code>z</code> is vertical</li><li><strong>3D</strong>: <code>(x, y, z)</code> standard Cartesian</li><li><strong>SDF convention</strong>: Negative inside body, positive outside</li></ul><h3 id="Naming-Conventions"><a class="docs-heading-anchor" href="#Naming-Conventions">Naming Conventions</a><a id="Naming-Conventions-1"></a><a class="docs-heading-anchor-permalink" href="#Naming-Conventions" title="Permalink"></a></h3><table><tr><th style="text-align: right">Suffix</th><th style="text-align: right">Meaning</th></tr><tr><td style="text-align: right"><code>!</code></td><td style="text-align: right">Mutating function (modifies arguments)</td></tr><tr><td style="text-align: right"><code>_u</code></td><td style="text-align: right">Operates on velocity fields</td></tr><tr><td style="text-align: right"><code>_p</code></td><td style="text-align: right">Operates on pressure fields</td></tr><tr><td style="text-align: right"><code>⁰</code></td><td style="text-align: right">Previous time step value</td></tr><tr><td style="text-align: right"><code>μ₀</code>, <code>μ₁</code></td><td style="text-align: right">BDIM moments</td></tr></table><h2 id="Extending-BioFlows"><a class="docs-heading-anchor" href="#Extending-BioFlows">Extending BioFlows</a><a id="Extending-BioFlows-1"></a><a class="docs-heading-anchor-permalink" href="#Extending-BioFlows" title="Permalink"></a></h2><h3 id="Adding-New-Body-Types"><a class="docs-heading-anchor" href="#Adding-New-Body-Types">Adding New Body Types</a><a id="Adding-New-Body-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-New-Body-Types" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Define custom body
struct MyBody &lt;: AbstractBody
    # fields
end

# Implement required methods
BioFlows.measure!(flow::Flow, body::MyBody; kwargs...) = ...</code></pre><h3 id="Adding-New-Diagnostics"><a class="docs-heading-anchor" href="#Adding-New-Diagnostics">Adding New Diagnostics</a><a id="Adding-New-Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-New-Diagnostics" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Add to Diagnostics.jl or create extension
function my_diagnostic(sim::Simulation)
    flow = sim.flow
    # Compute diagnostic from flow fields
end</code></pre><h3 id="Using-I/O-Features"><a class="docs-heading-anchor" href="#Using-I/O-Features">Using I/O Features</a><a id="Using-I/O-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Using-I/O-Features" title="Permalink"></a></h3><p>BioFlows includes JLD2 for saving simulation data:</p><pre><code class="language-julia hljs">using BioFlows
using JLD2

# Create diagnostic writers
writer = CenterFieldWriter(&quot;fields.jld2&quot;; interval=0.1)
force_writer = ForceWriter(&quot;forces.jld2&quot;)

# In simulation loop
file_save!(writer, sim, t)
record_force!(force_writer, sim, t)

# Close writers when done
close!(writer)
close!(force_writer)</code></pre><h3 id="Using-Plots/Makie-(Optional)"><a class="docs-heading-anchor" href="#Using-Plots/Makie-(Optional)">Using Plots/Makie (Optional)</a><a id="Using-Plots/Makie-(Optional)-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Plots/Makie-(Optional)" title="Permalink"></a></h3><p>If you load Plots.jl or Makie.jl, visualization functions become available:</p><pre><code class="language-julia hljs">using BioFlows
using Plots  # Enables flood, addbody, body_plot!, sim_gif!

# Or with Makie
using GLMakie  # Enables viz!, get_body, plot_body_obs!</code></pre><h2 id="Performance-Tips"><a class="docs-heading-anchor" href="#Performance-Tips">Performance Tips</a><a id="Performance-Tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Tips" title="Permalink"></a></h2><ol><li><strong>Use <code>remeasure=false</code></strong> for static bodies to skip SDF recomputation</li><li><strong>Set <code>JULIA_NUM_THREADS=auto</code></strong> for multi-threaded CPU execution</li><li><strong>Use GPU arrays</strong> (<code>CuArray</code>) for large 3D simulations</li><li><strong>Tune AMR parameters</strong>: Lower <code>regrid_interval</code> for fast-moving bodies</li><li><strong>Use <code>store_fluxes=false</code></strong> (default) unless debugging conservation</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../numerical_methods/">« Numerical Methods</a><a class="docs-footer-nextpage" href="../api/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">BioFlows.jl — High-Performance CFD in Julia</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 29 January 2026 08:10">Thursday 29 January 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
