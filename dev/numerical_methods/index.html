<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Numerical Methods · BioFlows.jl</title><meta name="title" content="Numerical Methods · BioFlows.jl"/><meta property="og:title" content="Numerical Methods · BioFlows.jl"/><meta property="twitter:title" content="Numerical Methods · BioFlows.jl"/><meta name="description" content="Documentation for BioFlows.jl."/><meta property="og:description" content="Documentation for BioFlows.jl."/><meta property="twitter:description" content="Documentation for BioFlows.jl."/><meta property="og:url" content="https://subhk.github.io/BioFlows.jl/numerical_methods/"/><meta property="twitter:url" content="https://subhk.github.io/BioFlows.jl/numerical_methods/"/><link rel="canonical" href="https://subhk.github.io/BioFlows.jl/numerical_methods/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BioFlows.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Numerical Methods</a><ul class="internal"><li><a class="tocitem" href="#Governing-Equations"><span>Governing Equations</span></a></li><li><a class="tocitem" href="#Staggered-Grid-(MAC-Grid)"><span>Staggered Grid (MAC Grid)</span></a></li><li><a class="tocitem" href="#Extension-to-3D"><span>Extension to 3D</span></a></li><li><a class="tocitem" href="#Finite-Difference-Operators"><span>Finite Difference Operators</span></a></li><li><a class="tocitem" href="#Time-Integration"><span>Time Integration</span></a></li><li><a class="tocitem" href="#Pressure-Solver"><span>Pressure Solver</span></a></li><li><a class="tocitem" href="#Immersed-Boundary-Method"><span>Immersed Boundary Method</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../core_types/">Core Types</a></li><li><a class="tocitem" href="../amr/">Adaptive Mesh Refinement</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Numerical Methods</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Numerical Methods</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/BioFlows.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/subhk/BioFlows.jl/blob/main/docs/src/numerical_methods.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Numerical-Methods"><a class="docs-heading-anchor" href="#Numerical-Methods">Numerical Methods</a><a id="Numerical-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-Methods" title="Permalink"></a></h1><p>This section describes the numerical methods used in BioFlows.jl for solving the incompressible Navier-Stokes equations.</p><h2 id="Governing-Equations"><a class="docs-heading-anchor" href="#Governing-Equations">Governing Equations</a><a id="Governing-Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Governing-Equations" title="Permalink"></a></h2><p>BioFlows.jl solves the incompressible Navier-Stokes equations in dimensional form:</p><p class="math-container">\[\frac{\partial \mathbf{u}}{\partial t} + (\mathbf{u} \cdot \nabla)\mathbf{u} = -\frac{1}{\rho}\nabla p + \nu \nabla^2 \mathbf{u}\]</p><p class="math-container">\[\nabla \cdot \mathbf{u} = 0\]</p><p>where:</p><ul><li><p class="math-container">\[\mathbf{u} = (u, v)\]</p>is the velocity field (m/s)</li><li><p class="math-container">\[p\]</p>is the pressure (Pa)</li><li><p class="math-container">\[\rho\]</p>is the density (kg/m³)</li><li><p class="math-container">\[\nu\]</p>is the kinematic viscosity (m²/s)</li></ul><h2 id="Staggered-Grid-(MAC-Grid)"><a class="docs-heading-anchor" href="#Staggered-Grid-(MAC-Grid)">Staggered Grid (MAC Grid)</a><a id="Staggered-Grid-(MAC-Grid)-1"></a><a class="docs-heading-anchor-permalink" href="#Staggered-Grid-(MAC-Grid)" title="Permalink"></a></h2><p>BioFlows.jl uses a <strong>staggered grid</strong> arrangement, also known as a Marker-And-Cell (MAC) grid. This arrangement naturally satisfies the discrete divergence-free condition and avoids spurious pressure oscillations (checkerboard modes).</p><h3 id="Variable-Locations-in-2D"><a class="docs-heading-anchor" href="#Variable-Locations-in-2D">Variable Locations in 2D</a><a id="Variable-Locations-in-2D-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Locations-in-2D" title="Permalink"></a></h3><p>On a staggered grid, different variables are stored at different locations within each cell:</p><ul><li><strong>Pressure</strong> (<span>$p$</span>): Cell centers</li><li><strong>x-velocity</strong> (<span>$u$</span>): Vertical cell faces (between left/right neighbors)</li><li><strong>y-velocity</strong> (<span>$v$</span>): Horizontal cell faces (between bottom/top neighbors)</li></ul><pre><code class="nohighlight hljs">         Δx
    ├─────────────┤

    ┌─────────────┬─────────────┬─────────────┐  ─┬─
    │             │             │             │   │
    │      ●      v      ●      v      ●      │   │
    │    p_i,j+1  │   p_i+1,j+1 │  p_i+2,j+1  │   │
    │             │             │             │   Δy
    u             u             u             u   │
    │             │             │             │   │
    │      ●      v      ●      v      ●      │  ─┴─
    │    p_i,j    │   p_i+1,j   │  p_i+2,j    │
    │             │             │             │
    u             u             u             u
    │             │             │             │
    │      ●      v      ●      v      ●      │
    │   p_i,j-1   │  p_i+1,j-1  │  p_i+2,j-1  │
    │             │             │             │
    └─────────────┴─────────────┴─────────────┘

    Legend:
    ●  = Pressure (p) at cell center
    u  = x-velocity component at vertical faces
    v  = y-velocity component at horizontal faces</code></pre><h3 id="Detailed-Single-Cell-View"><a class="docs-heading-anchor" href="#Detailed-Single-Cell-View">Detailed Single Cell View</a><a id="Detailed-Single-Cell-View-1"></a><a class="docs-heading-anchor-permalink" href="#Detailed-Single-Cell-View" title="Permalink"></a></h3><p>For a single cell <span>$(i,j)$</span>, the staggered arrangement is:</p><pre><code class="nohighlight hljs">                    v[i,j+1]
                       ↑
              ┌────────┼────────┐
              │        │        │
              │        │        │
    u[i,j] ───┼───── p[i,j] ────┼─── u[i+1,j]
      →       │        ●        │       →
              │                 │
              │                 │
              └────────┼────────┘
                       │
                       ↓
                    v[i,j]

    Grid spacing: Δx (horizontal), Δy (vertical)
    Cell center:  (i-½, j-½) in grid coordinates
    u location:   (i, j-½) - on left/right faces
    v location:   (i-½, j) - on bottom/top faces</code></pre><h3 id="Indexing-Convention"><a class="docs-heading-anchor" href="#Indexing-Convention">Indexing Convention</a><a id="Indexing-Convention-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing-Convention" title="Permalink"></a></h3><p>In BioFlows.jl, the arrays are indexed as follows:</p><table><tr><th style="text-align: right">Variable</th><th style="text-align: right">Array Index</th><th style="text-align: right">Physical Location</th></tr><tr><td style="text-align: right"><code>p[i,j]</code></td><td style="text-align: right">Cell <span>$(i,j)$</span></td><td style="text-align: right">Center of cell <span>$(i,j)$</span></td></tr><tr><td style="text-align: right"><code>u[i,j,1]</code></td><td style="text-align: right">Face <span>$(i,j)$</span></td><td style="text-align: right">Left face of cell <span>$(i,j)$</span></td></tr><tr><td style="text-align: right"><code>u[i,j,2]</code></td><td style="text-align: right">Face <span>$(i,j)$</span></td><td style="text-align: right">Bottom face of cell <span>$(i,j)$</span></td></tr></table><p>The velocity field is stored in a single array <code>u[I,d]</code> where <code>I</code> is the cell index and <code>d</code> is the direction (1=x, 2=y for 2D; 1=x, 2=y, 3=z for 3D).</p><h2 id="Extension-to-3D"><a class="docs-heading-anchor" href="#Extension-to-3D">Extension to 3D</a><a id="Extension-to-3D-1"></a><a class="docs-heading-anchor-permalink" href="#Extension-to-3D" title="Permalink"></a></h2><p>In three dimensions, the staggered grid extends naturally:</p><ul><li><strong>Pressure</strong> (<span>$p$</span>): Cell centers</li><li><strong>x-velocity</strong> (<span>$u$</span>): yz-faces (perpendicular to x)</li><li><strong>y-velocity</strong> (<span>$v$</span>): xz-faces (perpendicular to y)</li><li><strong>z-velocity</strong> (<span>$w$</span>): xy-faces (perpendicular to z)</li></ul><pre><code class="nohighlight hljs">                        z
                        │   y
                        │  /
                        │ /
                        │/
            ────────────┼──────────── x


                    ┌───────────────────┐
                   /│                  /│
                  / │       w_top     / │
                 /  │       ↑        /  │
                ┌───────────────────┐   │
                │   │      ●        │   │
          u_L → │   │    p_ijk      │ → u_R
                │   │               │   │
                │   └ ─ ─ ─ ─ ─ ─ ─ ┼ ─ ┘
                │  /                │  /
                │ /      ↓         │ /
                │/    w_bottom     │/
                └───────────────────┘
                      ↗       ↘
                   v_front   v_back


    Legend:
    ●     = Pressure at cell center (i,j,k)
    u_L   = u[i,j,k,1] at left face
    u_R   = u[i+1,j,k,1] at right face
    v     = v[i,j,k,2] at front/back faces
    w     = w[i,j,k,3] at top/bottom faces</code></pre><h2 id="Finite-Difference-Operators"><a class="docs-heading-anchor" href="#Finite-Difference-Operators">Finite Difference Operators</a><a id="Finite-Difference-Operators-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-Difference-Operators" title="Permalink"></a></h2><h3 id="Divergence"><a class="docs-heading-anchor" href="#Divergence">Divergence</a><a id="Divergence-1"></a><a class="docs-heading-anchor-permalink" href="#Divergence" title="Permalink"></a></h3><p>The discrete divergence operator at cell center <span>$(i,j)$</span>:</p><p class="math-container">\[(\nabla \cdot \mathbf{u})_{i,j} = \frac{u_{i+1,j} - u_{i,j}}{\Delta x} + \frac{v_{i,j+1} - v_{i,j}}{\Delta y}\]</p><h3 id="Gradient"><a class="docs-heading-anchor" href="#Gradient">Gradient</a><a id="Gradient-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient" title="Permalink"></a></h3><p>The discrete pressure gradient at face locations:</p><p class="math-container">\[\left(\frac{\partial p}{\partial x}\right)_{i,j} = \frac{p_{i,j} - p_{i-1,j}}{\Delta x} \quad \text{(at u-location)}\]</p><p class="math-container">\[\left(\frac{\partial p}{\partial y}\right)_{i,j} = \frac{p_{i,j} - p_{i,j-1}}{\Delta y} \quad \text{(at v-location)}\]</p><h3 id="Laplacian"><a class="docs-heading-anchor" href="#Laplacian">Laplacian</a><a id="Laplacian-1"></a><a class="docs-heading-anchor-permalink" href="#Laplacian" title="Permalink"></a></h3><p>The discrete Laplacian for the Poisson equation:</p><p class="math-container">\[\nabla^2 p_{i,j} = \frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{\Delta x^2} + \frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{\Delta y^2}\]</p><h2 id="Time-Integration"><a class="docs-heading-anchor" href="#Time-Integration">Time Integration</a><a id="Time-Integration-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Integration" title="Permalink"></a></h2><p>BioFlows.jl uses a <strong>2nd-order predictor-corrector</strong> (Heun&#39;s method) combined with pressure projection to ensure incompressibility. This provides 2nd-order temporal accuracy.</p><h3 id="Predictor-Step"><a class="docs-heading-anchor" href="#Predictor-Step">Predictor Step</a><a id="Predictor-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Predictor-Step" title="Permalink"></a></h3><p>First, compute a forward Euler prediction:</p><p class="math-container">\[\mathbf{u}^* = \mathbf{u}^n + \Delta t \left[ -(\mathbf{u}^n \cdot \nabla)\mathbf{u}^n + \nu \nabla^2 \mathbf{u}^n + \mathbf{g} \right]\]</p><p>Then project onto divergence-free space:</p><p class="math-container">\[\nabla^2 \phi = \nabla \cdot \mathbf{u}^*\]</p><p class="math-container">\[\mathbf{u}&#39; = \mathbf{u}^* - \nabla \phi\]</p><h3 id="Corrector-Step"><a class="docs-heading-anchor" href="#Corrector-Step">Corrector Step</a><a id="Corrector-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Corrector-Step" title="Permalink"></a></h3><p>Re-evaluate the right-hand side at the predicted velocity:</p><p class="math-container">\[\mathbf{f}&#39; = -(\mathbf{u}&#39; \cdot \nabla)\mathbf{u}&#39; + \nu \nabla^2 \mathbf{u}&#39; + \mathbf{g}\]</p><p>Average the predictor and corrector contributions (Heun&#39;s method):</p><p class="math-container">\[\mathbf{u}^{**} = \frac{1}{2}\left( \mathbf{u}&#39; + \mathbf{u}^n + \Delta t \, \mathbf{f}&#39; \right)\]</p><p>This is equivalent to the trapezoidal rule:</p><p class="math-container">\[\mathbf{u}^{**} = \mathbf{u}^n + \frac{\Delta t}{2} \left( \mathbf{f}^n + \mathbf{f}&#39; \right)\]</p><p>Finally, project onto divergence-free space:</p><p class="math-container">\[\nabla^2 \psi = \frac{2}{\Delta t} \nabla \cdot \mathbf{u}^{**}\]</p><p class="math-container">\[\mathbf{u}^{n+1} = \mathbf{u}^{**} - \frac{\Delta t}{2} \nabla \psi\]</p><h3 id="Summary-of-the-Algorithm"><a class="docs-heading-anchor" href="#Summary-of-the-Algorithm">Summary of the Algorithm</a><a id="Summary-of-the-Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-of-the-Algorithm" title="Permalink"></a></h3><pre><code class="nohighlight hljs">Algorithm: 2nd-order Predictor-Corrector with Pressure Projection
─────────────────────────────────────────────────────────────────
Input: uⁿ (divergence-free velocity at time tⁿ)
Output: uⁿ⁺¹ (divergence-free velocity at time tⁿ⁺¹)

1. Save: u⁰ ← uⁿ

2. PREDICTOR:
   a. f ← RHS(u⁰)                    // Convection + diffusion
   b. u* ← u⁰ + Δt·f                 // Forward Euler
   c. Solve ∇²φ = ∇·u*               // Pressure Poisson
   d. u&#39; ← u* - ∇φ                   // Project to div-free

3. CORRECTOR:
   a. f&#39; ← RHS(u&#39;)                   // Re-evaluate at predicted
   b. u** ← u&#39; + u⁰ + Δt·f&#39;          // Accumulate
   c. u** ← 0.5·u**                  // Average (Heun)
   d. Solve ∇²ψ = (2/Δt)·∇·u**       // Pressure Poisson
   e. uⁿ⁺¹ ← u** - (Δt/2)·∇ψ        // Final projection

4. Compute Δt from CFL condition</code></pre><h3 id="CFL-Condition"><a class="docs-heading-anchor" href="#CFL-Condition">CFL Condition</a><a id="CFL-Condition-1"></a><a class="docs-heading-anchor-permalink" href="#CFL-Condition" title="Permalink"></a></h3><p>The time step is constrained by the CFL (Courant-Friedrichs-Lewy) condition:</p><p class="math-container">\[\Delta t \leq \left( \sum_d \frac{|u_d|}{\Delta x_d} + \sum_d \frac{2\nu}{\Delta x_d^2} \right)^{-1}\]</p><p>where the first term is the convective constraint and the second is the diffusive constraint.</p><h2 id="Pressure-Solver"><a class="docs-heading-anchor" href="#Pressure-Solver">Pressure Solver</a><a id="Pressure-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Solver" title="Permalink"></a></h2><p>The pressure Poisson equation is solved using a <strong>geometric multigrid</strong> method with:</p><ul><li>Jacobi smoothing iterations</li><li>Full-weighting restriction</li><li>Bilinear interpolation for prolongation</li><li>V-cycle iteration until convergence</li></ul><p>The multigrid solver operates on a hierarchy of progressively coarser grids, enabling efficient solution of the elliptic pressure equation.</p><h2 id="Immersed-Boundary-Method"><a class="docs-heading-anchor" href="#Immersed-Boundary-Method">Immersed Boundary Method</a><a id="Immersed-Boundary-Method-1"></a><a class="docs-heading-anchor-permalink" href="#Immersed-Boundary-Method" title="Permalink"></a></h2><p>BioFlows.jl implements the <strong>Boundary Data Immersion Method (BDIM)</strong> for handling complex geometries. Bodies are defined implicitly through signed distance functions (SDFs):</p><p class="math-container">\[\phi(\mathbf{x}, t) &lt; 0 \quad \text{inside body}\]</p><p class="math-container">\[\phi(\mathbf{x}, t) = 0 \quad \text{on boundary}\]</p><p class="math-container">\[\phi(\mathbf{x}, t) &gt; 0 \quad \text{in fluid}\]</p><p>The SDF is used to:</p><ol><li>Identify solid and fluid regions</li><li>Interpolate boundary conditions</li><li>Compute surface normals: <span>$\mathbf{n} = \nabla\phi / |\nabla\phi|$</span></li><li>Calculate hydrodynamic forces on immersed bodies</li></ol><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ol><li><p>Harlow, F.H. and Welch, J.E. (1965). &quot;Numerical calculation of time-dependent viscous incompressible flow of fluid with free surface.&quot; <em>Physics of Fluids</em>, 8(12), 2182-2189.</p></li><li><p>Weymouth, G.D. and Yue, D.K.P. (2011). &quot;Boundary data immersion method for Cartesian-grid simulations of fluid-body interaction problems.&quot; <em>Journal of Computational Physics</em>, 230(16), 6233-6247.</p></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../core_types/">Core Types »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 23 December 2025 13:18">Tuesday 23 December 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
